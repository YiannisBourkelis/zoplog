#!/usr/bin/env bash
set -euo pipefail

# Clean all ZopLog nftables rules
# Usage: zoplog-nft-clean

export PATH="/usr/sbin:/sbin:/usr/bin:/bin:${PATH:-}"

NFT_BIN="/usr/sbin/nft"
if [[ ! -x "$NFT_BIN" ]]; then
  NFT_BIN="$(command -v nft || true)"
fi
if [[ -z "${NFT_BIN:-}" ]]; then
  echo "Error: nft binary not found in PATH" >&2
  exit 127
fi

TABLE="zoplog"

# Check if table exists, then delete it
if "$NFT_BIN" list table inet "$TABLE" >/dev/null 2>&1; then
  "$NFT_BIN" delete table inet "$TABLE"
  echo "ZopLog firewall table and all rules cleaned successfully."
else
  echo "No ZopLog firewall table found to clean."
fi